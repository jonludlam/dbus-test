<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xapi storage interfaces</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/app.css" />

    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  </head>
  <body>
<!DOCTYPE html>
<div class="title-bar" data-responsive-toggle="main-menu" data-hide-for="medium"><button class="menu-icon" type="button" data-toggle=""></button><div class="title-bar-title">Menu</div></div><div class="top-bar" id="main-menu"><div class="top-bar-left"><ul class="menu" data-dropdown-menu=""><li class="menu-text">SMAPIv3</li></ul></div><div class="top-bar-right"><ul class="menu" data-responsive-menu="drilldown medium-dropdown"><li class="has-submenu"><a href="features.html">Learn</a><ul class="submenu menu vertical" data-submenu=""><li><a href="features.html">Features</a></li><li><a href="concepts.html">Concepts</a></li><li><a href="architecture.html">Architecture</a></li><li><a href="faq.html">FAQ</a></li></ul></li><li><a href="#">Develop</a><ul class="submenu menu vertical" data-submenu=""><li><a href="plugin.html">plugin</a></li><li><a href="volume.html">volume</a></li><li><a href="datapath.html">datapath</a></li><li><a href="task.html">task</a></li></ul></li><li><a href="#">Support</a><ul class="submenu menu vertical" data-submenu=""><li><a href="contact.html">Mailing list</a></li><li><a href="contact.html">Issue tracker</a></li><li><a href="contact.html">IRC</a></li></ul></li><li class="active"><a href="getstarted.html">Get Started</a></li></ul></div></div><div class="row">
<h1>Architecture</h1>
<p>
The system is divided into two parts, intended for people with different expertise:
<ol>
<li>Volume Plugin: this is the storage control-plane. Xapi delegates Volume
    manipulation requests to these plugins, which know how to operate on the physical
    storage which could be anything from an NFS/CIFS server, an iSCSI target or
    a Ceph deployment.
    <b>No virtualisation knowledge is required to write a Volume Plugin</b>.
    The
    volume plugin do not perform I/O directly, instead they associate volumes
    with URIs which encode a particular method for accessing the disk data.
    For example an NFS plugin could expose URIs of the form
    <tt>nfs://server/path/file</tt>
    </li>
<li>Datapath Plugin: this is the storage data-plane.
    This is Xen-specific code which
    chooses the best way to connect VMs to individual disks.
    <b>Xen expertise is needed to write a datapath plugin.</b>
    Note that this code doesn't
    know about volumes; it only knows about specific volume access protocols
    such as NFS, iSCSI and RBD.
</ol>
</p>
<h2>Volume Plugins</h2>
<p>
Clients such as
<a href="http://www.openstack.org/">OpenStack</a>,
<a href="http://cloudstack.apache.org/">CloudStack</a>,
<a href="https://github.com/xenserver/xenadmin">XenCenter</a> and
<a href="https://xen-orchestra.com">Xen Orchestra</a>
create VMs and virtual disks by sending XenAPI requests to Xapi. Xapi doesn't
know how to manipulate storage directly, so it delegates storage operations
to a <b>Volume Plugin</b>. Each &quot;Storage Repository&quot; is
associated with exactly one Volume Plugin. These plugins know how to
<ul>
<li>create volumes;</li>
<li>destroy volumes;</li>
<li>snapshot volumes;</li>
<li>clone volumes;</li> and
<li>list the ways in which a volume may be accessed.</li>
</ul>
The following diagram shows a XenAPI client sending a VDI.create request causing
Xapi to send a Volume.create request to a specific plugin:
</p>
<img src="img/arch-vol-create.svg"
     alt="Diagram showing a XenAPI client sending a VDI.create request causing Xapi to send a Volume.create request to a plugin."/>

<h2>Datapath Plugins</h2>
<p>
The following diagram shows a XenAPI client sending a VM.start request. Xapi
calls <b>Volume.stat</b> to list the available access methods for the VM's disks.
The Ceph Volume Plugin returns a URL of the form <tt>rbd://server/pool</tt>
so Xapi consults its "rbd" Datapath plugin and asks &quot;how should I connect
this datapath to the VM?&quot;. The datapath plugin tells Xapi to use QEMU qdisk's
built-in support for RBD via librados, so Xapi tells libxl to set this up.
</p>
<img src="img/arch-vm-start.svg"
     alt="Diagram showing a XenAPI client sending a VM.start request."/>

</div>


    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>
