<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xapi storage interfaces</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/app.css" />

    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  </head>
  <body>
<!DOCTYPE html>

<div class="title-bar" data-responsive-toggle="main-menu" data-hide-for="medium">
  <button class="menu-icon" type="button" data-toggle=""></button>
  <div class="title-bar-title">Menu</div>
</div>

    <div class="top-bar" id="main-menu">
      <div class="top-bar-left">
	<ul class="menu" data-dropdown-menu="">
	  <li class="menu-text">SMAPIv3</li>
	</ul>
      </div>
      <div class="top-bar-right">
	<ul class="menu" data-responsive-menu="drilldown medium-dropdown">
	  <li class="has-submenu">
            <a href="features.html">Learn</a>
            <ul class="submenu menu vertical" data-submenu="">
              <li><a href="features.html">Features</a></li>
              <li><a href="concepts.html">Concepts</a></li>
              <li><a href="architecture.html">Architecture</a></li>
              <li><a href="volume_migration.html">Volume migration</a></li>
              <li><a href="faq.html">FAQ</a></li>
            </ul>
	  </li>
	  <li>
            <a href="#">Develop</a>
            <ul class="submenu menu vertical">
              
      <li><a href="plugin.html">plugin</a></li>
    
      <li><a href="volume.html">volume</a></li>
    
      <li><a href="datapath.html">datapath</a></li>
    
            </ul>
	  </li>
	  <li>
            <a href="#">Support</a>
            <ul class="submenu menu vertical">
              <li><a href="contact.html">Mailing list</a></li>
              <li><a href="contact.html">Issue tracker</a></li>
              <li><a href="contact.html">IRC</a></li>
            </ul>
	  </li>
	  <li class="active"><a href="getstarted.html">Get Started</a></li>
	</ul>
      </div>
    </div>
<!DOCTYPE html>

    <div class="row">

    
      <div class="large-3 medium-3 columns">
        <ul class="menu vertical">
          <li class="docs-nav-title">types</li>
          
      <li><a href="#a-0">debug_info</a></li>
    
      <li><a href="#a-1">query_result</a></li>
    
          
      <li class="docs-nav-title">interface: Plugin</li>
      
      
      <li><a href="#a-Plugin-query">query</a></li>
    
      <li><a href="#a-Plugin-ls">ls</a></li>
    
      <li><a href="#a-Plugin-diagnostics">diagnostics</a></li>
    
    
          <li class="docs-nav-title">exception</li>
          <li><a href="#a-exceptions">Exceptions</a></li>
        </ul>
      </div>
  

    <div class="large-9 medium-9 columns">
      <h1>plugin</h1>
      <p>The xapi toolstack expects all plugins to support a basic query interface.</p>
      
    <h4 id="a-0">type debug_info = string</h4>
    <p> Debug context from the caller </p>
  
    <h4 id="a-1">type query_result = struct  { ... }</h4>
    <p> properties of this implementation </p>
  
      <p>Members:</p>
    
    <table width="100%">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
      
      <tr>
        <td><pre>plugin</pre></td>
        <td><pre>string</pre></td>
        <td>plugin name, used in the XenAPI as SR.type</td></tr>
    
      <tr>
        <td><pre>name</pre></td>
        <td><pre>string</pre></td>
        <td>short name</td></tr>
    
      <tr>
        <td><pre>description</pre></td>
        <td><pre>string</pre></td>
        <td>description</td></tr>
    
      <tr>
        <td><pre>vendor</pre></td>
        <td><pre>string</pre></td>
        <td>entity (e.g. company, project, group) which produced this implementation</td></tr>
    
      <tr>
        <td><pre>copyright</pre></td>
        <td><pre>string</pre></td>
        <td>copyright</td></tr>
    
      <tr>
        <td><pre>version</pre></td>
        <td><pre>string</pre></td>
        <td>version</td></tr>
    
      <tr>
        <td><pre>required_api_version</pre></td>
        <td><pre>string</pre></td>
        <td>minimum required API version</td></tr>
    
      <tr>
        <td><pre>features</pre></td>
        <td><pre>string list</pre></td>
        <td>features supported by this plugin</td></tr>
    
      <tr>
        <td><pre>configuration</pre></td>
        <td><pre>(string * string) list</pre></td>
        <td>key/description pairs describing required device_config parameters</td></tr>
    
      <tr>
        <td><pre>required_cluster_stack</pre></td>
        <td><pre>string list</pre></td>
        <td>the plugin requires one of these cluster stacks to be active</td></tr>
    
      </tbody>
    </table>
  
      
    <h2 id="a-Plugin">Plugin</h2>
    <p>Discover properties of this implementation. Every implementation  must support the query interface or it will not be recognised as  a storage plugin by xapi.</p>
    
    
    <h3 id="a-Plugin-query">query</h3>
    <p>Query this implementation and return its properties. This is  called by xapi to determine whether it is compatible with xapi  and to discover the supported features.</p>
    
    <ul class="tabs" data-tabs="" id="tab-query">
     <li class="tabs-title is-active"><a href="#defn-query" aria-selected="true">Definition</a></li>
     <li class="tabs-title"><a href="#ocaml-query">OCaml example</a></li>
     <li class="tabs-title"><a href="#python-query">Python example</a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="tab-query">
      <div class="tabs-panel is-active" id="defn-query">
        
  <table width="100%">
  <thead>
    <tr>
      <th>Name</th>
      <th>Direction</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td><code>dbg</code></td>
      <td>in</td>
      <td><code> <a href="#a-0">debug_info</a> </code></td>
      <td>Debug context from the caller</td>
    </tr>
  
    <tr>
      <td><code>query_result</code></td>
      <td>out</td>
      <td><code> <a href="#a-1">query_result</a> </code></td>
      <td>The properies of this implementation</td>
    </tr>
  
  </tbody>
  </table>
  
      </div>
      <div class="tabs-panel" id="ocaml-query">
        <h4>Client</h4>
        
<pre>
<span style="color:#990000">(* these directives only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt.syntax&quot;</span>;;
#require <span style="color:#aa4444">&quot;rpc.unix&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>

<span style="color:green">module</span> <span style="color:#0033cc">Client</span> = <span style="color:#0033cc">Plugin_client</span>(<span style="color:#990099">struct</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Lwt</span>
    <span style="color:green">let</span> rpc call = return (<span style="color:#0033cc">Rpc_client</span>.do_rpc ~content_type:<span style="color:#0033cc">`</span><span style="color:#0033cc">XML</span> ~path:<span style="color:#aa4444">&quot;/&quot;</span> ~host:<span style="color:#aa4444">&quot;127.0.0.1&quot;</span> ~port:80 call) <span style="color:#990000">(* TODO: Rpc_client needs to support Lwt *)</span>
<span style="color:#990099">end</span>)

<span style="color:green">let</span> result = <span style="color:#0033cc">Client</span>.query ~dbg:<span style="color:#aa4444">&quot;string&quot;</span>;;</pre>


        <h4>Server</h4>
        
<pre>
<span style="color:#990000">(* this line only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>

<span style="color:green">module</span> <span style="color:#0033cc">Plugin_myimplementation</span> = <span style="color:green">functor</span>(<span style="color:#0033cc">M</span>: <span style="color:#0033cc">M</span>) -&gt; <span style="color:#990099">struct</span>
    <span style="color:#990000">(* by default every operation will return a 'not implemented' exception *)</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Plugin_skeleton</span>(<span style="color:#0033cc">M</span>)
    <span style="color:#990000">(* ... *)</span>
    <span style="color:green">let</span> query x =
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>.<span style="color:#0033cc">Plugin</span>.<span style="color:#0033cc">Query</span> <span style="color:green">in</span>
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span> <span style="color:green">in</span>
        return (<span style="color:#0033cc">`</span><span style="color:#0033cc">Ok</span> (<span style="color:#0033cc">Out</span>.({ plugin = <span style="color:#aa4444">&quot;string&quot;</span>; name = <span style="color:#aa4444">&quot;string&quot;</span>; description = <span style="color:#aa4444">&quot;string&quot;</span>; vendor = <span style="color:#aa4444">&quot;string&quot;</span>; copyright = <span style="color:#aa4444">&quot;string&quot;</span>; version = <span style="color:#aa4444">&quot;string&quot;</span>; required_api_version = <span style="color:#aa4444">&quot;string&quot;</span>; features = [ <span style="color:#aa4444">&quot;string&quot;</span>; <span style="color:#aa4444">&quot;string&quot;</span> ]; configuration = [ (<span style="color:#aa4444">&quot;string&quot;</span>, <span style="color:#aa4444">&quot;string&quot;</span>) ]; required_cluster_stack = [ <span style="color:#aa4444">&quot;string&quot;</span>; <span style="color:#aa4444">&quot;string&quot;</span> ] })))
    <span style="color:#990000">(* ... *)</span>
<span style="color:#990099">end</span></pre>


      </div>
      <div class="tabs-panel" id="python-query">
        <h4>Client</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

if __name__ == &quot;__main__&quot;:
    c = xapi.connect()
    results = c.Plugin.query({ dbg: &quot;string&quot; })
    print (repr(results))
        </pre>
        <h4>Server</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

class Plugin_myimplementation(Plugin_skeleton):
    # by default each method will return a Not_implemented error
    # ...
    def query(self, dbg):
        &quot;&quot;&quot;Discover properties of this implementation. Every implementation  must support the query interface or it will not be recognised as  a storage plugin by xapi.&quot;&quot;&quot;
        result = {}
        result[&quot;query_result&quot;] = { &quot;plugin&quot;: &quot;string&quot;, &quot;name&quot;: &quot;string&quot;, &quot;description&quot;: &quot;string&quot;, &quot;vendor&quot;: &quot;string&quot;, &quot;copyright&quot;: &quot;string&quot;, &quot;version&quot;: &quot;string&quot;, &quot;required_api_version&quot;: &quot;string&quot;, &quot;features&quot;: [ &quot;string&quot;, &quot;string&quot; ], &quot;configuration&quot;: { &quot;string&quot;: &quot;string&quot; }, &quot;required_cluster_stack&quot;: [ &quot;string&quot;, &quot;string&quot; ] }
        return result
    # ...
        </pre>
      </div>
    </div>
  
  
    <h3 id="a-Plugin-ls">ls</h3>
    <p>[ls dbg]: returns a list of attached SRs</p>
    
    <ul class="tabs" data-tabs="" id="tab-ls">
     <li class="tabs-title is-active"><a href="#defn-ls" aria-selected="true">Definition</a></li>
     <li class="tabs-title"><a href="#ocaml-ls">OCaml example</a></li>
     <li class="tabs-title"><a href="#python-ls">Python example</a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="tab-ls">
      <div class="tabs-panel is-active" id="defn-ls">
        
  <table width="100%">
  <thead>
    <tr>
      <th>Name</th>
      <th>Direction</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td><code>dbg</code></td>
      <td>in</td>
      <td><code> <a href="#a-0">debug_info</a> </code></td>
      <td>Debug context from the caller</td>
    </tr>
  
    <tr>
      <td><code>srs</code></td>
      <td>out</td>
      <td><code>string list</code></td>
      <td>The attached SRs</td>
    </tr>
  
  </tbody>
  </table>
  
      </div>
      <div class="tabs-panel" id="ocaml-ls">
        <h4>Client</h4>
        
<pre>
<span style="color:#990000">(* these directives only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt.syntax&quot;</span>;;
#require <span style="color:#aa4444">&quot;rpc.unix&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>

<span style="color:green">module</span> <span style="color:#0033cc">Client</span> = <span style="color:#0033cc">Plugin_client</span>(<span style="color:#990099">struct</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Lwt</span>
    <span style="color:green">let</span> rpc call = return (<span style="color:#0033cc">Rpc_client</span>.do_rpc ~content_type:<span style="color:#0033cc">`</span><span style="color:#0033cc">XML</span> ~path:<span style="color:#aa4444">&quot;/&quot;</span> ~host:<span style="color:#aa4444">&quot;127.0.0.1&quot;</span> ~port:80 call) <span style="color:#990000">(* TODO: Rpc_client needs to support Lwt *)</span>
<span style="color:#990099">end</span>)

<span style="color:green">let</span> result = <span style="color:#0033cc">Client</span>.ls ~dbg:<span style="color:#aa4444">&quot;string&quot;</span>;;</pre>


        <h4>Server</h4>
        
<pre>
<span style="color:#990000">(* this line only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>

<span style="color:green">module</span> <span style="color:#0033cc">Plugin_myimplementation</span> = <span style="color:green">functor</span>(<span style="color:#0033cc">M</span>: <span style="color:#0033cc">M</span>) -&gt; <span style="color:#990099">struct</span>
    <span style="color:#990000">(* by default every operation will return a 'not implemented' exception *)</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Plugin_skeleton</span>(<span style="color:#0033cc">M</span>)
    <span style="color:#990000">(* ... *)</span>
    <span style="color:green">let</span> ls x =
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>.<span style="color:#0033cc">Plugin</span>.<span style="color:#0033cc">Ls</span> <span style="color:green">in</span>
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span> <span style="color:green">in</span>
        return (<span style="color:#0033cc">`</span><span style="color:#0033cc">Ok</span> (<span style="color:#0033cc">Out</span>.([ <span style="color:#aa4444">&quot;string&quot;</span>; <span style="color:#aa4444">&quot;string&quot;</span> ])))
    <span style="color:#990000">(* ... *)</span>
<span style="color:#990099">end</span></pre>


      </div>
      <div class="tabs-panel" id="python-ls">
        <h4>Client</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

if __name__ == &quot;__main__&quot;:
    c = xapi.connect()
    results = c.Plugin.ls({ dbg: &quot;string&quot; })
    print (repr(results))
        </pre>
        <h4>Server</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

class Plugin_myimplementation(Plugin_skeleton):
    # by default each method will return a Not_implemented error
    # ...
    def ls(self, dbg):
        &quot;&quot;&quot;Discover properties of this implementation. Every implementation  must support the query interface or it will not be recognised as  a storage plugin by xapi.&quot;&quot;&quot;
        result = {}
        result[&quot;srs&quot;] = [ &quot;string&quot;, &quot;string&quot; ]
        return result
    # ...
        </pre>
      </div>
    </div>
  
  
    <h3 id="a-Plugin-diagnostics">diagnostics</h3>
    <p>Returns a printable set of backend diagnostic information. Implementations are encouraged to include any data which will  be useful to diagnose problems. Note this data should not  include personally-identifiable data as it is intended to be  automatically included in bug reports.</p>
    
    <ul class="tabs" data-tabs="" id="tab-diagnostics">
     <li class="tabs-title is-active"><a href="#defn-diagnostics" aria-selected="true">Definition</a></li>
     <li class="tabs-title"><a href="#ocaml-diagnostics">OCaml example</a></li>
     <li class="tabs-title"><a href="#python-diagnostics">Python example</a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="tab-diagnostics">
      <div class="tabs-panel is-active" id="defn-diagnostics">
        
  <table width="100%">
  <thead>
    <tr>
      <th>Name</th>
      <th>Direction</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    
    <tr>
      <td><code>dbg</code></td>
      <td>in</td>
      <td><code> <a href="#a-0">debug_info</a> </code></td>
      <td>Debug context from the caller</td>
    </tr>
  
    <tr>
      <td><code>diagnostics</code></td>
      <td>out</td>
      <td><code>string</code></td>
      <td>A string containing loggable human-readable diagnostics information</td>
    </tr>
  
  </tbody>
  </table>
  
      </div>
      <div class="tabs-panel" id="ocaml-diagnostics">
        <h4>Client</h4>
        
<pre>
<span style="color:#990000">(* these directives only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt&quot;</span>;;
#require <span style="color:#aa4444">&quot;lwt.syntax&quot;</span>;;
#require <span style="color:#aa4444">&quot;rpc.unix&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>

<span style="color:green">module</span> <span style="color:#0033cc">Client</span> = <span style="color:#0033cc">Plugin_client</span>(<span style="color:#990099">struct</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Lwt</span>
    <span style="color:green">let</span> rpc call = return (<span style="color:#0033cc">Rpc_client</span>.do_rpc ~content_type:<span style="color:#0033cc">`</span><span style="color:#0033cc">XML</span> ~path:<span style="color:#aa4444">&quot;/&quot;</span> ~host:<span style="color:#aa4444">&quot;127.0.0.1&quot;</span> ~port:80 call) <span style="color:#990000">(* TODO: Rpc_client needs to support Lwt *)</span>
<span style="color:#990099">end</span>)

<span style="color:green">let</span> result = <span style="color:#0033cc">Client</span>.diagnostics ~dbg:<span style="color:#aa4444">&quot;string&quot;</span>;;</pre>


        <h4>Server</h4>
        
<pre>
<span style="color:#990000">(* this line only needed in a toplevel: *)</span>
#require <span style="color:#aa4444">&quot;xcp-api-client&quot;</span>;;

<span style="color:#cc9900">open</span> <span style="color:#0033cc">S</span>
<span style="color:#cc9900">open</span> <span style="color:#0033cc">Plugin</span>

<span style="color:green">module</span> <span style="color:#0033cc">Plugin_myimplementation</span> = <span style="color:green">functor</span>(<span style="color:#0033cc">M</span>: <span style="color:#0033cc">M</span>) -&gt; <span style="color:#990099">struct</span>
    <span style="color:#990000">(* by default every operation will return a 'not implemented' exception *)</span>
    <span style="color:#cc9900">include</span> <span style="color:#0033cc">Plugin_skeleton</span>(<span style="color:#0033cc">M</span>)
    <span style="color:#990000">(* ... *)</span>
    <span style="color:green">let</span> diagnostics x =
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span>.<span style="color:#0033cc">Plugin</span>.<span style="color:#0033cc">Diagnostics</span> <span style="color:green">in</span>
        <span style="color:green">let</span> <span style="color:#cc9900">open</span> <span style="color:#0033cc">Types</span> <span style="color:green">in</span>
        return (<span style="color:#0033cc">`</span><span style="color:#0033cc">Ok</span> (<span style="color:#0033cc">Out</span>.(<span style="color:#aa4444">&quot;string&quot;</span>)))
    <span style="color:#990000">(* ... *)</span>
<span style="color:#990099">end</span></pre>


      </div>
      <div class="tabs-panel" id="python-diagnostics">
        <h4>Client</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

if __name__ == &quot;__main__&quot;:
    c = xapi.connect()
    results = c.Plugin.diagnostics({ dbg: &quot;string&quot; })
    print (repr(results))
        </pre>
        <h4>Server</h4>
        <pre class="prettyprint lang-py">
        
import xmlrpclib
import xapi
from storage import *

class Plugin_myimplementation(Plugin_skeleton):
    # by default each method will return a Not_implemented error
    # ...
    def diagnostics(self, dbg):
        &quot;&quot;&quot;Discover properties of this implementation. Every implementation  must support the query interface or it will not be recognised as  a storage plugin by xapi.&quot;&quot;&quot;
        result = {}
        result[&quot;diagnostics&quot;] = &quot;string&quot;
        return result
    # ...
        </pre>
      </div>
    </div>
  
  
  
      
    <h3 id="a-exceptions">exceptions</h3>
    <table width="100%">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
     </thead>
     <tbody>
       
      <tr>
        <td><pre>Unimplemented</pre></td>
        <td><pre>string</pre></td>
        <td>The operation has not been implemented</td>
      </tr>
    
     </tbody>
    </table>
  
    </div>
    </div>
  

    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>
